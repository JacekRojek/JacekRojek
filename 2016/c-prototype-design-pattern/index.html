<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width initial-scale=1" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  <title>C# Prototype Design Pattern</title>
  <meta name="description" content="Software development blog">
  <meta name="author" content="Jacek Rojek">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Jacek  Rojek">
  <meta name="twitter:description" content="Software development blog">

  <meta property="og:type" content="article">
  <meta property="og:title" content="Jacek  Rojek">
  <meta property="og:description" content="Software development blog">

  <link rel="apple-touch-icon" sizes="57x57" href="/JacekRojek/images/favicons/apple-touch-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/JacekRojek/images/favicons/apple-touch-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/JacekRojek/images/favicons/apple-touch-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/JacekRojek/images/favicons/apple-touch-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/JacekRojek/images/favicons/apple-touch-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/JacekRojek/images/favicons/apple-touch-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/JacekRojek/images/favicons/apple-touch-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/JacekRojek/images/favicons/apple-touch-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/JacekRojek/images/favicons/apple-touch-icon-180x180.png">
  <link rel="icon" type="image/png" href="/JacekRojek/images/favicons/favicon-32x32.png" sizes="32x32">
  <link rel="icon" type="image/png" href="/JacekRojek/images/favicons/favicon-194x194.png" sizes="194x194">
  <link rel="icon" type="image/png" href="/JacekRojek/images/favicons/favicon-96x96.png" sizes="96x96">
  <link rel="icon" type="image/png" href="/JacekRojek/images/favicons/android-chrome-192x192.png" sizes="192x192">
  <link rel="icon" type="image/png" href="/JacekRojek/images/favicons/favicon-16x16.png" sizes="16x16">
  <link rel="manifest" href="/JacekRojek/images/favicons/manifest.json">
  <link rel="shortcut icon" href="/JacekRojek/images/favicons/favicon.ico">
  <meta name="msapplication-TileColor" content="#ffc40d">
  <meta name="msapplication-TileImage" content="/JacekRojek/images/favicons/mstile-144x144.png">
  <meta name="theme-color" content="#ffffff">

  <link rel="stylesheet" href="/JacekRojek/css/main.css">
  <link rel="canonical" href="https://jacekrojek.github.io/JacekRojek//JacekRojek//2016/c-prototype-design-pattern/">
  <link rel="alternate" type="application/rss+xml" title="Jacek  Rojek" href="/JacekRojek/feed.xml">
</head>


  <body>
    <span class="mobile btn-mobile-menu">
  <i class="icon icon-list btn-mobile-menu__icon"></i>
  <i class="icon icon-x-circle btn-mobile-close__icon hidden"></i>
</span>
  
<header class="panel-cover" style="background-image: url(/JacekRojek/images/cover.jpg)">
  <div class="panel-main">

    <div class="panel-main__inner panel-inverted">
    <div class="panel-main__content">
        <a href="/JacekRojek/" title="link to home of Jacek  Rojek">
          <img src="/JacekRojek/images/profile.jpg" class="user-image" alt="My Profile Photo">
          <h1 class="panel-cover__title panel-title">Jacek  Rojek</h1>
        </a>
        <hr class="panel-cover__divider">
        <p class="panel-cover__description">Software development blog</p>
        <hr class="panel-cover__divider panel-cover__divider--secondary">

        <div class="navigation-wrapper">

          <nav class="cover-navigation cover-navigation--primary">
            <ul class="navigation">
              <li class="navigation__item"><a href="/JacekRojek/#blog" title="link to Jacek  Rojek blog" class="blog-button">Blog</a></li>
            </ul>
          </nav>

          <nav class="cover-navigation navigation--social">
            <ul class="navigation">
          
            
              <!-- Twitter -->
              <li class="navigation__item">
                <a href="http://twitter.com/JRojek93" title="@JRojek93 on Twitter" target="_blank">
                  <i class="icon icon-social-twitter"></i>
                  <span class="label">Twitter</span>
                </a>
              </li>
            

            
              <!-- Facebook -->
              <li class="navigation__item">
                <a href="http://fb.me/jacek.rojek.7" title="jacek.rojek.7 on Facebook" target="_blank">
                  <i class="icon icon-social-facebook"></i>
                  <span class="label">Facebook</span>
                </a>
              </li>
            

            
              <!-- LinkedIn -->
              <li class="navigation__item">
                <a href="https://www.linkedin.com/in/jacek-rojek-b7a396105" title="jacek-rojek-b7a396105 on LinkedIn" target="_blank">
                  <i class="icon icon-social-linkedin"></i>
                  <span class="label">LinkedIn</span>
                </a>
              </li>
            

            
              <!-- GitHub -->
              <li class="navigation__item">
                <a href="https://www.github.com/JacekRojek" title="JacekRojek on GitHub" target="_blank">
                  <i class="icon icon-social-github"></i>
                  <span class="label">GitHub</span>
                </a>
              </li>
            

            
              <!-- Email -->
              <li class="navigation__item">
                <a href="mailto:j.rojek19@gmail.com" title="Email j.rojek19@gmail.com" target="_blank">
                  <i class="icon icon-mail"></i>
                  <span class="label">Email</span>
                </a>
              </li>
            

            <!-- RSS -->
            <li class="navigation__item">
              <a href="/JacekRojek/feed.xml" title="Subscribe" target="_blank">
                <i class="icon icon-rss"></i>
                <span class="label">RSS</span>
              </a>
            </li>
          
            </ul>
          </nav>

        </div>

      </div>

    </div>

    <div class="panel-cover--overlay"></div>
  </div>
</header>


    <div class="content-wrapper">
      <div class="content-wrapper__inner">
        <article class="post-container post-container--single">
  <header class="post-header">
    <div class="post-meta">
      <time datetime="29 Jun 2016" class="post-meta__date date">29 Jun 2016</time> &#8226; <span class="post-meta__tags">on </span>
    </div>
    <h1 class="post-title">C# Prototype Design Pattern</h1>
  </header>

  <section class="post">
    <p><a href="http://pastebin.com/R3ZigGwa">Link to source code</a></p>

<p>This is the last creational pattern in this series. And it’s used to create clones of objects without using references. C# is giving us helpful method MemberwiseClone() that is doing all cloning in the background. Later in the article I’ll cover the difference between Shadow and Deep Cloning.</p>
<blockquote>The MemberwiseClone method creates a shallow copy by creating a new object, and then copying the nonstatic fields of the current object to the new object. If a field is a value type, a bit-by-bit copy of the field is performed. If a field is a reference type, the reference is copied but the referred object is not; therefore, the original object and its clone refer to the same object.</blockquote>
<p>In my example I’m creating copy of the Enemy object that will keep the same ID as the base object.</p>
<h3>UML diagram</h3>
<p> </p>

<p><img class="alignnone size-full wp-image-3591" src="https://indiedevart.files.wordpress.com/2016/06/l10.png" alt="l10" width="490" height="433" /></p>
<h2>Prototype</h2>
<p>First thing to do is the interface that will be implemented by concrete class. This is an interface which is used for the types of object that can be cloned itself.</p>

<div class="language-c# highlighter-rouge"><pre class="highlight"><code>
<span class="k">public</span> <span class="k">abstract</span> <span class="k">class</span> <span class="nc">AbstractEnemy</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">_id</span><span class="p">;</span>

  <span class="k">public</span> <span class="kt">int</span> <span class="n">Id</span>
  <span class="p">{</span>
    <span class="k">get</span> <span class="p">{</span> <span class="k">return</span> <span class="n">_id</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">set</span> <span class="p">{</span> <span class="n">_id</span> <span class="p">=</span> <span class="k">value</span><span class="p">;</span> <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">public</span> <span class="k">abstract</span> <span class="n">AbstractEnemy</span> <span class="nf">Clone</span><span class="p">();</span>
<span class="p">}</span>

</code></pre>
</div>

<p>This time implementation will be very simple thank to the MemberwiseClone() method.</p>

<div class="language-c# highlighter-rouge"><pre class="highlight"><code>
<span class="k">class</span> <span class="nc">Enemy</span> <span class="p">:</span> <span class="n">AbstractEnemy</span>
<span class="p">{</span>
  <span class="k">public</span> <span class="k">override</span> <span class="n">AbstractEnemy</span> <span class="nf">Clone</span><span class="p">()</span>
  <span class="p">{</span>
      <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(&amp;</span><span class="n">quot</span><span class="p">;</span><span class="n">cloning</span> <span class="n">enemy</span><span class="p">...&amp;</span><span class="n">quot</span><span class="p">;);</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nf">MemberwiseClone</span><span class="p">()</span> <span class="k">as</span> <span class="n">AbstractEnemy</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
</div>

<p>One last thing to create is the Client Class that will create instance of an enemy and perform the cloning procedure.</p>
<h2>Client</h2>
<p>~~~ c#<br />
static void Main(string[] args)
{
   Enemy enemy = new Enemy();
   enemy.Id = 1;</p>

<p>Console.WriteLine("Enemy Copy ID: " + enemy.Id.ToString());</p>

<p>Enemy clonedEnemy = enemy.Clone() as Enemy;</p>

<p>Console.WriteLine("Enemy Copy ID: " + clonedEnemy.Id.ToString());
 }
 }
 ~~~</p>

<p> </p>
<h3>Difference between Shadow and Deep Cloning</h3>
<p>The problem with the memberwise copy is that it creates a shallow copy of the object i.e. if the object contains any reference types then only the address of that reference type will be copied from source to target and both the versions will keep pointing to the same object. Changing properties of inner-class of one object will change them for other class as well.<span style="font-family:'Segoe UI';font-size:small;">
</span></p>
<ul>
	<li>
<blockquote>A shallow copy copies all reference types or value types, but it does not copy the objects that the references refer to. The references in the new object point to the same objects that the references in the original object points to.</blockquote>
</li>
	<li>
<blockquote> Deep copy of an object copies the elements and everything directly or indirectly referenced by the elements.</blockquote>
</li>
</ul>
<p>Solution to this problem is to create  new Copy() method that will involve copying the inner class properties to new object. or to include copy() method to all object sub classes, just as it was implemented in previous example.</p>

<p> </p>

<p>~~~ c#</p>

<p>public override AbstractEnemy Clone()
 {
    Enemy cloned = this.MemberwiseClone() as Enemy;
    cloned.Equipment = new Equipment();
    cloned.Equipment.Armor = this.Equipment.Armor;</p>

<div class="highlighter-rouge"><pre class="highlight"><code> return cloned as AbstractEnemy;  }  ~~~    
</code></pre>
</div>

<p>To conclude, this pattern specifies the kind of objects to create using a prototypical instance, and create new objects by copying this prototype. I hope you learned something new. In next series of articles I’ll start moving into low level languages. Stay Awesome!</p>

  </section>
  
  <script>

</script>

</article>



      </div>

      <footer class="footer">
  <span class="footer__copyright">&copy; 2016 Jacek Rojek. All rights reserved.</span>
</footer> 

<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<script type="text/javascript" src="/JacekRojek/js/main.js"></script>

    </div>
  </body>
</html>